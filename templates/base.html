{% load i18n %}
{% load staticfiles %}
{% load compress %}
{% load propose_resource_tags %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}My Next Destination{% endblock %}</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans">
	{% compress css inline %}
        <link rel="stylesheet" href="{% static 'css/fontawesome/css/font-awesome.min.css' %}">
	    <link rel="stylesheet" href="{% static 'js/slick/slick.min.css' %}">
	    <link rel="stylesheet" href="{% static 'js/selectmenu/jquery-ui.min.css' %}">
	    <link rel="stylesheet" href="{% static 'css/style.min.css' %}">
    {% endcompress %}

    {% block extra_styles %}{% endblock %}
</head>
<body>
    {% block header %}
        {% include 'partials/_header.html' %}
	{% endblock %}
	{% block content_wrapper %}
    <main>
        {% block content %}

        {% endblock %}

        {% block subscribe %}
		    <section class="section-subs">
		    	<div class="container">
		    		<div class="section-subs__main">
		    			<h2 class="section-title">{% trans 'Подписаться на новости' %}</h2>
		    			<h3>{% blocktrans %}Все полезные ресурсы для путешествия в одном месте. Открывайте новые города с нами.{% endblocktrans %}</h3>
		    			<form action="" class="subs-form">
		    				<div class="subs-form__inner clr">
		    					<div class="input-wrap">
		    						<input type="email" class="t-input subs-form__input" placeholder="Email" required>
		    					</div>
		    					<input type="submit" value="{% trans 'Подписаться' %}" class="btn subs-form__submit">
		    				</div>
		    			</form>
		    		</div>
		    		<div class="section-subs__thank">
		    			<h2 class="section-title">{% blocktrans %}Спасибо за подписку!{% endblocktrans %}</h2>
		    			<h3>{% blocktrans %}Все полезные ресурсы для путешествия в одном месте. Открывайте новые города с нами.{% endblocktrans %}</h3>
		    			<p class="section-subs__check">{% blocktrans %}Проверьте Ваш email, пожалуйста!{% endblocktrans %}</p>
		    		</div>
		    	</div>
		    </section>
        {% endblock %}
        {% block about %}
		    <section class="section-about">
		    	<div class="container">
		    		<div class="section-about__text">
		    			<h2 class="section-title">{% trans 'О сервисе' %}</h2>
		    			<p>{% blocktrans %}Мы сделали подборку по сервисам, которые помогут Вам путешествовать с удобством.{% endblocktrans %}</p>
		    			<p>{% blocktrans %}Некоторые сервисы расскажут отом как забронировать от отеля до автомобиля, а некоторые - как найти удивительные места, воспользоваться услугами гида или сэкономить.{% endblocktrans %}</p>
		    		</div>
		    		<div class="section-about__share">
		    			<p>{% blocktrans %}Поделитесь с нами интересными ресурсами{% endblocktrans %}</p>
		    			<a href="#" class="btn btn_light btn_xs section-about__share-btn" data-popup="popup-offer">Предложить ресурс</a>
		    		</div>
		    	</div>
		    </section>
        {% endblock %}
	</main>
    {% endblock %}

	{% block footer %}
        {% include 'partials/_footer.html' %}
	{% endblock %}

	<div class="popup popup-offer" id="popup-offer">
		<div class="popup__window">
			<a href="#" class="popup__close"></a>
			<h2 class="popup__title">Здорово делиться интересными ресурсами!</h2>

            {% get_form %}

			<div class="popup-offer__thank">
				<div class="popup-offer__thank-inner">
					<img src="img/icon-ok.svg" alt="" class="popup-offer__thank-icon">
					<p>Спасибо ваш ресурс <br>принят!</p>
				</div>
			</div>
		</div>
	</div>


    {% compress js %}
	    <script src="{% static 'js/jquery-3.1.1.min.js' %}"></script>
	    <script src="{% static 'js/slick/slick.min.js' %}"></script>
	    <script src="{% static 'js/selectmenu/jquery-ui.min.js' %}"></script>
	    <script src="{% static 'js/jquery.validate.min.js' %}"></script>
	    <script src="{% static 'js/main.min.js' %}"></script>
        <script type="text/javascript">
        // In a perfect world, this would be its own library file that got included
        // on the page and only the ``$(document).ready(...)`` below would be present.
        // But this is an example.

        var Autocomplete = function(options) {
          this.form_selector = options.form_selector;
          this.url = options.url || '/search/autocomplete/';
          this.delay = parseInt(options.delay || 300);
          this.minimum_length = parseInt(options.minimum_length || 3);
          this.form_elem = null;
          this.query_box = null
        };

        Autocomplete.prototype.setup = function() {
          var self = this;

          this.form_elem = $(this.form_selector);
          this.query_box = this.form_elem.find('input[name=q]');

          // Watch the input box.
          this.query_box.on('keyup', function() {
            var query = self.query_box.val();

            if(query.length < self.minimum_length) {
              return false
            }

            self.fetch(query)
          });

          // On selecting a result, populate the search field.

        };

        Autocomplete.prototype.fetch = function(query) {
          var self = this;

          $.ajax({
            dataType: "json",
            url: this.url
          , data: {
              'q': query
            }
          , success: function(data) {
                console.log(query, data);
              self.show_results(data)
            }
          })
        };

        Autocomplete.prototype.show_results = function(data) {
          // Remove any existing results.
          $('.top-search-form__tips').remove();

          var results = data.result || [];
          var results_wrapper = $('<ul class="top-search-form__tips"></ul>');
          var base_elem = $('<li class="top-search-form__tips-item"><a href="#" class="ac-result"></a></li>');

          if(results.length > 0) {
            for(var res_offset in results) {
              var elem = base_elem.clone();
              // Don't use .html(...) here, as you open yourself to XSS.
              // Really, you should use some form of templating.
              elem.find('.ac-result').attr("href", results[res_offset][1]).text(results[res_offset][0]);
              results_wrapper.append(elem)
            }
          }
          else {
            var elem = base_elem.clone();
            elem.text("No results found.");
            results_wrapper.append(elem)
          }

          this.query_box.after(results_wrapper)
        };

        $(document).ready(function() {
          window.autocomplete = new Autocomplete({
            form_selector: '.top-search-form'
          });
          window.autocomplete.setup()
        })
  </script>
    {% endcompress %}
    {% block extra_scripts %}

    {% endblock %}
</body>
</html>